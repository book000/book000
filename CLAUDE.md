# CLAUDE.md - Claude Code 作業方針

## 目的

このファイルは、Claude Code がこのリポジトリで作業する際の方針、ルール、およびプロジェクト固有の情報を定義します。

## 判断記録のルール

すべての重要な判断は、以下の形式で記録してください：

1. **判断内容の要約**: 何を決定したか
2. **検討した代替案**: どのような選択肢があったか
3. **採用しなかった案とその理由**: なぜ他の案を選ばなかったか
4. **前提条件・仮定・不確実性**: 判断の前提となる条件や仮定
5. **他エージェントによるレビュー可否**: 他のエージェント（Codex、Gemini）にレビューを依頼すべきか

**重要**: 前提・仮定・不確実性を明示し、仮定を事実のように扱わないこと。

## プロジェクト概要

- **目的**: book000 (Tomachi) の GitHub プロフィールリポジトリを管理
- **主な機能**:
  - GitHub メトリクスの自動生成（hourly）
  - 月次更新 Issue の自動作成（monthly）
  - プロフィール README の管理

## 重要ルール

### 言語ルール

- **会話言語**: 日本語
- **コード内コメント**: 日本語
- **エラーメッセージ**: 英語
- **日本語と英数字の間**: 半角スペースを挿入

### コミット・PR ルール

- **コミットメッセージ**: [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従う
  - 形式: `<type>(<scope>): <description>`
  - `<description>` は日本語で記載
  - 例: `feat: メトリクス生成ワークフローを追加`
- **ブランチ命名**: [Conventional Branch](https://conventional-branch.github.io) に従う
  - 形式: `<type>/<description>`
  - `<type>` は短縮形（feat, fix）を使用
  - 例: `feat/add-monthly-update`

## 環境のルール

- **GitHub リポジトリの調査**: テンポラリディレクトリに `git clone` してコード検索を実施する。
- **Renovate PR**: Renovate が作成した既存の PR に対して、追加コミットや更新を行わない。
- **Bash 環境**: Git Bash で動作。PowerShell コマンドを使用する場合は、明示的に `powershell -Command ...` または `pwsh -Command ...` を使用する。

## Git Worktree

このリポジトリでは Git Worktree を使用しません。

## コード改修時のルール

- **日本語と英数字の間**: 半角スペースを挿入する。
- **エラーメッセージ**: 既存のエラーメッセージで絵文字がある場合、エラーメッセージに即した一文字の絵文字を設定する。
- **ドキュメント**: 関数やワークフローには、コメント・説明を日本語で記載する。

## 相談ルール

Codex CLI や Gemini CLI の他エージェントに相談できます。以下の観点で使い分けてください：

### Codex CLI (ask-codex)

- ワークフローやスクリプトに対するレビュー
- bash スクリプトの設計、実装方針の技術判断
- 実装の正当性確認、機械的ミスの検出、既存コードとの整合性確認

### Gemini CLI (ask-gemini)

- GitHub Actions の最新仕様、gh CLI の最新機能など、最新の適切な情報が必要な判断
- 外部一次情報の確認、最新仕様の調査、外部前提条件の検証

### 他エージェントへの対応ルール

他エージェントが指摘・異議を提示した場合、Claude Code は必ず以下のいずれかを行う。黙殺・無言での不採用は禁止する。

- 指摘を受け入れ、判断を修正する
- 指摘を退け、その理由を明示する

以下は必ず実施すること：

- 他エージェントの提案を鵜呑みにせず、その根拠や理由を理解する
- 自身の分析結果と他エージェントの意見が異なる場合は、双方の視点を比較検討する
- 最終的な判断は、両者の意見を総合的に評価した上で、自身で下す

## 開発コマンド

このリポジトリはプロフィールリポジトリのため、通常の開発コマンドはありません。

### ワークフロー実行

```bash
# Metrics の手動実行
gh workflow run metrics.yml

# 月次更新 Issue の手動作成
gh workflow run monthly-update.yml

# ワークフローの実行状況を確認
gh run list
```

## アーキテクチャと主要ファイル

### アーキテクチャ

このリポジトリは以下の構成になっています：

- **README.md**: GitHub プロフィールページとして表示される
- **.github/workflows/**: GitHub Actions ワークフロー
- **github-webhook-bridge/**: 別プロジェクトの設定ファイル
- **github-metrics.svg**: メトリクス画像（自動生成）

### 主要ファイル

| ファイル | 説明 |
|---------|------|
| `README.md` | プロフィール情報（自己紹介、スキル、リンク） |
| `.github/workflows/metrics.yml` | GitHub メトリクス生成ワークフロー |
| `.github/workflows/monthly-update.yml` | 月次更新 Issue 作成ワークフロー |
| `.github/update-template.md` | 月次更新 Issue のテンプレート |
| `github-metrics.svg` | GitHub メトリクス画像（自動生成） |

## 実装パターン

### 推奨パターン

- **ワークフロー**: GitHub Actions のベストプラクティスに従う
- **bash スクリプト**: ShellCheck に準拠する
- **YAML**: 2 スペースのインデント

### 非推奨パターン

- トークンやシークレットをハードコードする
- プライベートリポジトリの情報を公開する

## テスト

### テスト方針

- **手動テスト**: ワークフローの手動実行により動作を確認
- **ローカルテスト**: 可能な限り、ローカル環境でスクリプトをテストしてからコミット

### テスト追加条件

- ワークフローを変更した場合は、手動実行で動作を確認する
- bash スクリプトを変更した場合は、ローカル環境でテストする

## ドキュメント更新ルール

### 更新対象

- **README.md**: プロフィール情報、スキル、リンクを最新に保つ
- **.github/update-template.md**: 月次更新 Issue のテンプレート
- ワークフローファイル: 変更時は動作確認を実施

### 更新タイミング

- README.md: プロフィール情報に変更があった場合
- .github/update-template.md: 月次更新フォーマットを変更する場合
- ワークフローファイル: 機能追加や修正を行った場合

## 作業チェックリスト

### 新規改修時

1. プロジェクトを理解する
2. 作業ブランチが適切であることを確認する
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する
4. PR がクローズされた不要ブランチが削除済みであることを確認する
5. ~~指定されたパッケージマネージャーで依存関係をインストールする~~（このリポジトリでは不要）

### コミット・プッシュ前

1. Conventional Commits に従っていることを確認する
2. センシティブな情報が含まれていないことを確認する
3. ~~Lint / Format エラーがないことを確認する~~（bash スクリプトは ShellCheck で確認）
4. 動作確認を行う（ワークフローの手動実行など）

### PR 作成前

1. PR 作成の依頼があることを確認する
2. センシティブな情報が含まれていないことを確認する
3. コンフリクトの恐れがないことを確認する

### PR 作成後

1. コンフリクトがないことを確認する
2. PR 本文が最新状態のみを網羅していることを確認する
3. `gh pr checks <PR ID> --watch` で CI を確認する
4. Copilot レビューに対応し、コメントに返信する
5. Codex のコードレビューを実施し、指摘対応を行う
6. PR 本文の崩れがないことを確認する

## リポジトリ固有

- このリポジトリは GitHub プロフィールページ（`https://github.com/book000`）として表示される。
- README.md の変更は即座にプロフィールページに反映される。
- GitHub Actions ワークフローは以下の2つ：
  - `metrics.yml`: GitHub メトリクスの SVG を hourly で生成
  - `monthly-update.yml`: 月初に Renovate PR の一覧を含む Issue を作成
- `github-webhook-bridge` ディレクトリには、別プロジェクト（[book000/github-webhook-bridge](https://github.com/book000/github-webhook-bridge)）の設定ファイルが含まれる。
- MIT ライセンスで公開されており、他者がプロフィール README の参考として利用可能。
- GitHub Secrets に保存された `METRICS_TOKEN` を使用して、メトリクスを生成する。
